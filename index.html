<script>
const words = [/* your word list here */];
let shuffled = [], currentIndex = 0, score = 0, missed = [];
let synth = window.speechSynthesis;
let voices = [], selectedVoice = null;

// UI
const prompt = document.getElementById("prompt");
const answer = document.getElementById("answer");
const feedback = document.getElementById("feedback");
const scoreDisplay = document.getElementById("score");
const startBtn = document.getElementById("start");
const submitBtn = document.getElementById("submit");
const repeatBtn = document.getElementById("repeat");
const bar = document.getElementById("bar");
const voiceSelect = document.getElementById("voiceSelect");
const missedWords = document.getElementById("missedWords");

function isiOS() {
  return /iPad|iPhone|iPod/.test(navigator.userAgent);
}

// ðŸ”Š Load and choose voice
function populateVoices() {
  voices = synth.getVoices().filter(v => v.lang.startsWith("en"));
  voiceSelect.innerHTML = "";

  voices.forEach((voice, i) => {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = `${voice.name} (${voice.lang})`;
    voiceSelect.appendChild(opt);
  });

  let preferred;
  if (!isiOS()) {
    preferred = voices.find(v => v.name.includes("Google US English"));
  }
  if (!preferred) {
    // pick first American English voice available
    preferred = voices.find(v => v.lang === "en-US") || voices[0];
  }

  selectedVoice = preferred || voices[0];
  if (selectedVoice) {
    const idx = voices.indexOf(selectedVoice);
    voiceSelect.value = idx;
  }
}

populateVoices();
if (speechSynthesis.onvoiceschanged !== undefined) {
  speechSynthesis.onvoiceschanged = populateVoices;
}

voiceSelect.addEventListener("change", () => {
  selectedVoice = voices[voiceSelect.value];
});

function speak(text) {
  if (!selectedVoice) return alert("No voice available yet!");
  if (synth.speaking) synth.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.voice = selectedVoice;
  u.lang = selectedVoice.lang;
  u.rate = 0.9;
  synth.speak(u);
}

// ðŸ§  rest of your game functions (unchanged)
</script>

